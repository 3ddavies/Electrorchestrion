from binascii import unhexlify

from mididictionaries import *
#<MTrk event> = <delta-time> <event>
#for meta dt00ffblahblahblah
def keysig(ks):
	pass

y = '00ff7f0d050f1c323030332e31322e303100ff7f08050f1200007f7f0000ff5103068a1a00ff58040402180800ff2f00'
#####00ff7f0d050f1c323030332e31322e303100ff7f08050f1200007f7f0000ff5103068a1a00ff58040402180800ff2f00
z="00ff03095361786f70686f6e658c00c44100b4076401b45b2801943a57827e943e5702843a57827e843e5700944157830084415700944557830084455700944357830084435700944157830084415700943e578300843e5700943a578300843a5700943c578300843c5700943f578300843f57009443578300844357009446578300844657009445578b5c84455724943a578300843a5700943e578300843e5700944157830084415700944557830084455700944357830084435700944157830084415700943e578300843e5700943a578300843a5700943c578300843c5700943f578300843f5700944357830084435700944657830084465700944557856e844557838012944166825084416630944366825084436630944566825084456630944366884c8443668c34944566825084456630944566825084456630944366825084436630944566884c844566893494466682508446663094466682508446663094456682508445663094466682508446663094466682508446668330944566825084456630943f668250843f6630943f668250843f6630943e668250843e6630943f668550843f668c3094456682508445663094456682508445663094436682508443663094456682508445668630944366825084436630943e668250843e6630943e668250843e6630943c668250843c6630943e668550843e663094416682508441668930944866825084486630944866825084486630944666825084466630944866825084486630944666825084466630944866825084486630944666825084466630944966852084496660944966852084496660944a668250844a663094486682508448668630944566825084456630944366856e8443668f1294456682508445663094456682508445663094436682508443663094456685508445668c3094466682508446663094466682508446663094456682508445663094466682508446663094466682508446668330944566825084456630943f668250843f668330943e668250843e6630943f668550843f668930943c668520843c6660943f668250843f6630944366855084436630944666825084466630944666825084466630944666825084466630944866912084486660944666825084466630944866825084486630944a668520844a6660944a668520844a6660944a668250844a6630944666825084466630944a668250844a66309446668d408446669340944161830084416100944361830084436100944561825084456130944361884c8443618f34944961830084496100944561830084456100944061830084406100943e61884c843e619b34944764830084476400944664830084466400944564830084456400944464830084446400944364884c8443648334944561825084456130944861830084486100944561830084456100944361825084436130944161830084416100944161830084416100944161830084416100944161856e84416112943c64884c843c648334944861825084486130944861825084486130944661825084466130944861825084486130944661825084466130944861825084486130944661825084466130944961852084496160944961852084496160944a618250844a6130944861825084486130944561830084456100944161825e84416122943e61884c843e618334944561825084456130944361856e8443618f12944561825084456130944561825084456130944361825084436130944561825e84456122943e61884c843e619b34944361830084436100944161830084416100943f618300843f6100943e618300843e6100943c618520843c6160943f618250843f6130944361855084436130944661825084466130944661825084466130944661825084466130944861912084486160944666825084466630944866825084486630944a668520844a6660944a668520844a6660944a668250844a6630944666825084466630944a668250844a66309446668d4084466600ff2f00"
x="00ff20010000ff0307547261636b203800ff0309326e6420566f696365e60090417f825080417f3090437f825080437f3090417f825080417f3090417f884c80417f8c3490407f825080407f3090407f825080407f3090407f825080407f3090407f884c80407f893490427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f833090427f825080427f30903b7f8250803b7f30903b7f8250803b7f30903b7f8250803b7f30903b7f8550803b7f8c3090407f825080407f3090407f825080407f3090407f825080407f3090407f825080407f863090407f825080407f3090397f825080397f3090397f825080397f3090397f825080397f3090397f855080397f30903c7f8250803c7f893090457f825080457f3090457f825080457f3090437f825080437f3090457f825080457f3090437f825080437f3090457f825080457f3090437f825080437f3090447f852080447f6090447f852080447f6090457f825080457f3090457f825080457f863090417f825080417f3090417f856e80417f8f1290407f825080407f3090407f825080407f3090407f825080407f3090407f855080407f8c3090427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f833090427f825080427f30903b7f8250803b7f8330903b7f8250803b7f30903b7f8550803b7f893090377f852080377f60903c7f8250803c7f30903f7f8550803f7f3090437f825080437f3090437f825080437f3090437f825080437f3090427f912080427f6090427f825080427f3090427f825080427f3090467f852080467f6090467f852080467f6090467f825080467f3090437f825080437f3090467f825080467f3090417f8d4080417f83874090417f825080417f3090437f825080437f3090417f825080417f3090417f884c80417f8c3490407f825080407f3090407f825080407f3090407f825080407f3090407f884c80407f893490427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f833090427f825080427f30903b7f8250803b7f30903b7f8250803b7f30903b7f8250803b7f30903b7f8550803b7f8c3090407f825080407f3090407f825080407f3090407f825080407f3090407f825080407f863090407f825080407f3090397f825080397f3090397f825080397f3090397f825080397f3090397f855080397f30903c7f8250803c7f893090457f825080457f3090457f825080457f3090437f825080437f3090457f825080457f3090437f825080437f3090457f825080457f3090437f825080437f3090447f852080447f6090447f852080447f6090457f825080457f3090457f825080457f863090417f825080417f3090417f856e80417f8f1290407f825080407f3090407f825080407f3090407f825080407f3090407f855080407f8c3090427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f3090427f825080427f833090427f825080427f30903b7f8250803b7f8330903b7f8250803b7f30903b7f8550803b7f893090377f852080377f60903c7f8250803c7f30903f7f8550803f7f3090437f825080437f3090437f825080437f3090437f825080437f3090427f912080427f6090427f825080427f3090427f825080427f3090467f852080467f6090467f852080467f6090467f825080467f3090437f825080437f3090467f825080467f3090417f8d4080417f00ff2f00"
#the output is an array containing arrays for each event. The final array will be several of the following:
#[deltatime, eventID, eventname, [arbitrary bytes in hex], [bytes in hex of event.]]
def mparse(stringcheese):
	ta = [(stringcheese[i:i+2]) for i in range(0, len(stringcheese), 2)]#splits the track string into an array of bytes.
	tapc = 0#pos counter
	trackeventsarray = []#stores all events in a track.
	while len(ta) > tapc:
		print('tapc '+str(tapc))
		edt = ta[tapc]#event delta time
		tapc+=1
		arb = []
		if ta[tapc] == "ff":#indicates MIDI meta event
			tapc+=1
			rmc = ta[tapc]#this is the identifier of the meta instruction.
			tapc+=1
			if midimeta[rmc][2] == 'vlv':
				print(True)
				vlvl = True#loop condition
				vlvs = ''#vlv string
				while vlvl == True:
					vlvs+=ta[tapc]
					tapc+=1
					if int(ta[tapc], 16) < 128:#indicates that next value will not be  part of the vlv
						vlvl = False
				print(vlvs)
				print(int(vlvs,16))
			
				eventlength = int(vlvs,16)#this will tell us how many bytes the event is.
			else:
				for k in range(0,midimeta[rmc][1]):
					arb.append(ta[tapc])
					tapc+=1
				#tapc +=midimeta[rmc][1]#this will insure arbitrary bytes are ignored.
				eventlength = midimeta[rmc][2]
				
			eventraw = []
			for j in range(0, eventlength):
				eventraw.append(ta[tapc])
				tapc+=1
			event = [edt, rmc, midimeta[rmc][0], arb, eventraw]
			if midimeta[rmc][3] == True:
				event.append(unhexlify("".join(eventraw)).decode())
			#print(vlvs)
			#print(int(vlvs,16))
			print(event)
			print(len(eventraw))
			#tapc+=1#this is to avoid needlessly reading the '00' that preceeds FF.
			trackeventsarray.append(event)
		elif ta[tapc] == "f0":#indicates f0 sysex event
			print("f0 sysex event")

		elif ta[tapc] == "f7":#indicates f7 sysex event
			print("f7 sysex event")

		else:
			print("stuck!", ta[tapc])
			exit()
	return trackeventsarray
print(mparse(x))